<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <style type="text/css">
     .y_axis path, .x_axis path {
        fill:none;
        stroke:#000;
     }

     .tick line {
        stroke:#000;
     }
  </style>
<!--   <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script> -->
    <script type="text/javascript">
      function draw(data) {
      
      /*
        D3.js setup code
      */

          "use strict";
          var margin = 75,
              width = 1400,
              height = 600;
          var svg = d3.select("body").append('svg').attr("width",width).attr("height",height);

          var circleMargin = 20;
          var legendWidth = 300;
          var legend = svg.append('g').attr("class","legend").attr("transform","translate("+(width-legendWidth)+","+circleMargin+")");

          legend.append('circle').attr('cx',10).attr('cy',10).attr('r',4).attr('fill','red');
          legend.append('text').attr('y',15).attr('x',25).text('USA');
          legend.append('circle').attr('cx',10).attr('cy',30).attr('r',2).attr('fill','blue');
          legend.append('text').attr('y',35).attr('x',25).text("Others");

          var g = svg.append('g').attr("transform","translate("+margin+","+margin+")")

          var xScale = d3.time.scale().range([0,width-2*margin]).domain(d3.extent(data, function(d){
              return d['date']
          })); 
          var yScale = d3.scale.linear().range([0,height-2*margin]).domain(d3.extent(data,function(d){
            return d['attendance']
          }));

          var xAxis = d3.svg.axis().scale(xScale).ticks(d3.time.year,4).orient("bottom");
          var yAxis  = d3.svg.axis().scale(yScale).orient("left");

          g.append('g').attr('class','x_axis').attr('transform','translate(0,'+(height-2*margin)+')').call(xAxis);
          g.append('g').attr('class','y_axis').call(yAxis);
          g.append('g').selectAll('circle').data(data).enter().append('circle')
          .attr('cx',function(d){
              return xScale(d['date'])
          })
          .attr('cy',function(d){
              return yScale(d['attendance'])
          })
          .attr('r',function(d){
              if(d['team1']=="USA")
                return 4;
              return 2;
          })
          .attr('fill',function(d){
            if(d['team1']=="USA")
              return "red";
            return "blue";
          });
        };
      </script>
  </head>
<body>
  <svg width="1400" height="600"></svg>
  <script type="text/javascript">
  /*
    Use D3 (not dimple.js) to load the TSV file
    and pass the contents of it to the draw function
    */
    var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");
    var projection = d3.geo.mercator().translate([width/2-50,height/2]).scale(190);
    var path = d3.geo.path().projection(projection);
    d3.json("countries.geo.json",function(data){
      svg.selectAll('path').data(data.features).enter()
      .append("path").attr("d",path).attr("fill","#4683b4").attr("stroke","#000").attr("stroke-width",0.5)
    })
   d3.tsv("world_cup.tsv", function(d){
      d['date']=d3.time.format("%d-%m-%Y (%H:%M h)").parse(d['date']);
      d['attendance']=+d['attendance'];
      return d;
    },function(data){
        debugger;
        d3.nest().key(function(d){
            return d['date'].getUTCFullYear();
        }).rollup(function(leaves){
            var total = d3.sum(leaves, function(d){
                return d['attendance'];
            });
            var coords_lat = d3.map(leaves, function(d){
                return d[]
            })
        }).entries(data);
    });
  </script>
</body>
</html>
